import io.

%/*
% Entry point of the program.
% 
% Main function is automatically called from the picat system after
%  load and compile program with {@code picat ARGS} command.
%*/
main => 
	setlog.

%/*
% Entry point for setlog system.
%*/
setlog => 
	top_level.

%/*
% Reads the formula and starts the solver.
%*/
top_level =>
	print("{log} => "),
	Fi = read_file_terms(),
	% debug terms read.
	log_d("constraints read: " ++ Fi.to_string),
	solve(Fi).
	%Constraints = solve(Goal),
	%println(Constraints.to_string).

%solve(Goal) = Constraints =>
%	TODO


% goal: 
% - leggere le formule L_BR e tradurle in un formato interno (termini picat).
% - applicare il solver sulle formule (vedi funzione solve)
%   - il solver appl

%/*
% SAT for BR formulas.
%*/
solve(Fi) =>
	Fi := sort_infer(Fi)
	do
		Fi1 := Fi,
		do
			Fi2 := Fi,
			Fi := step(Fi)
		while(Fi = Fi2)	
	while(Fi = Fi1).
	

sort_infer(Fi).

solve([X = Y]), X = Y => true.
solve([X = Y]), X != Y => false.

log_d(Value) =>
	print("[DEBUG] "),
	println(Value).